datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

enum MethodProvider {
  kakao
  apple
}

model UserModel {
  userId String @id @default(uuid())

  realname String
  phoneNo  String
  email    String?
  birthday DateTime
  number   LicenseModel?

  methods  MethodModel[]
  sessions SessionModel[]
  coupons  CouponModel[]

  usedAt    DateTime  @default(now())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model PhoneModel {
  phoneId String @id @default(uuid())

  phoneNo String
  code    String?

  usedAt    DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model MethodModel {
  methodId    String @id @default(uuid())
  description String

  userId String
  user   UserModel @relation(fields: [userId], references: [userId])

  provider MethodProvider
  identity String

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model SessionModel {
  sessionId String @id @default(uuid())

  userId String
  user   UserModel @relation(fields: [userId], references: [userId])

  platform       String  @default("")
  messagingToken String?

  usedAt    DateTime  @default(now())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model LicenseModel {
  licenseId String @id @default(uuid())

  userId String
  user   UserModel @relation(fields: [userId], references: [userId])

  realname   String?
  birthday   DateTime
  licenseStr String?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model CouponGroupModel {
  couponGroupId String @id @default(uuid())

  code            String
  name String
  description String

  discountGroupId String?
  limit Int?  

  coupons CouponModel[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model CouponModel {
  couponId String @id @default(uuid())

  userId String
  user   UserModel @relation(fields: [userId], references: [userId])

  discountId String?

  couponGroupId String
  couponGroup   CouponGroupModel @relation(fields: [couponGroupId], references: [couponGroupId])

  usedAt    DateTime?
  expiredAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}
